<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>T√¢m S·ª± ƒê√™m Valentine | Professional Interactive Experience</title>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@1,600;1,700&display=swap" rel="stylesheet">

    <style>
        /* ---------------------------------------------------------
        1. CSS VARIABLES & THEMING SYSTEM 
        ---------------------------------------------------------
        */
        :root {
            --primary-accent: #ff85a2;
            --primary-dark: #0f0f13;
            --secondary-dark: #1a1a24;
            --text-main: #f8f9fa;
            --text-dim: #a0a0b0;
            --glass-bg: rgba(255, 255, 255, 0.04);
            --glass-border: rgba(255, 133, 162, 0.15);
            --shadow-soft: 0 20px 60px rgba(0, 0, 0, 0.5);
            --transition-speed: 0.4s;
            --font-display: 'Playfair Display', serif;
            --font-body: 'Quicksand', sans-serif;
        }

        /* ---------------------------------------------------------
        2. GLOBAL RESET & BASE STYLES
        ---------------------------------------------------------
        */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            height: 100%;
            width: 100%;
            background-color: var(--primary-dark);
            color: var(--text-main);
            font-family: var(--font-body);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ---------------------------------------------------------
        3. BACKGROUND ENGINE (CANVAS & OVERLAYS)
        ---------------------------------------------------------
        */
        #master-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: radial-gradient(circle at center, #1e1e2f 0%, #0f0f13 100%);
        }

        .vignette {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.6) 100%);
            z-index: -1;
            pointer-events: none;
        }

        /* ---------------------------------------------------------
        4. LAYOUT COMPONENTS (CONTAINER & CARDS)
        ---------------------------------------------------------
        */
        .main-wrapper {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
            padding: 20px;
        }

        .soul-card {
            width: 100%;
            max-width: 580px;
            min-height: 500px;
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border);
            border-radius: 45px;
            padding: 50px 40px;
            position: relative;
            box-shadow: var(--shadow-soft);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        /* ---------------------------------------------------------
        5. TYPOGRAPHY & HEADINGS
        ---------------------------------------------------------
        */
        .heading-display {
            font-family: var(--font-display);
            font-size: 2.5rem;
            color: var(--primary-accent);
            margin-bottom: 15px;
            text-shadow: 0 5px 15px rgba(255, 133, 162, 0.3);
        }

        .message-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 25px;
            margin-bottom: 35px;
            font-size: 1.1rem;
            line-height: 1.7;
            text-align: center;
            color: #d1d1e0;
            border: 1px solid rgba(255,255,255,0.03);
        }

        /* ---------------------------------------------------------
        6. INTERACTIVE ELEMENTS (INPUTS & BUTTONS)
        ---------------------------------------------------------
        */
        .soul-input-container {
            width: 100%;
            margin-bottom: 40px;
            position: relative;
        }

        .input-underlined {
            width: 100%;
            background: transparent;
            border: none;
            border-bottom: 2px solid rgba(255, 133, 162, 0.3);
            padding: 15px 0;
            color: #fff;
            font-size: 1.4rem;
            text-align: center;
            font-family: var(--font-body);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            outline: none;
        }

        .input-underlined:focus {
            border-bottom-color: var(--primary-accent);
            letter-spacing: 2px;
            transform: scale(1.02);
        }

        .btn-stack {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            width: 100%;
        }

        .action-btn {
            padding: 18px 25px;
            background: transparent;
            border: 1px solid rgba(255, 133, 162, 0.5);
            color: var(--primary-accent);
            border-radius: 100px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .action-btn:hover {
            background: var(--primary-accent);
            color: #000;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 133, 162, 0.3);
        }

        /* ---------------------------------------------------------
        7. PROGRESS INDICATORS
        ---------------------------------------------------------
        */
        .progress-system {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.05);
            margin-top: 40px;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .progress-core {
            height: 100%;
            background: linear-gradient(90deg, #ff85a2, #ffb3c6);
            width: 0%;
            transition: width 0.6s cubic-bezier(0.65, 0, 0.35, 1);
            box-shadow: 0 0 15px var(--primary-accent);
        }

        /* ---------------------------------------------------------
        8. STEP ANIMATIONS ENGINE
        ---------------------------------------------------------
        */
        .step-panel {
            display: none;
            width: 100%;
            flex-direction: column;
            align-items: center;
        }

        .step-panel.active {
            display: flex;
            animation: panelFadeIn 0.8s forwards;
        }

        @keyframes panelFadeIn {
            from { opacity: 0; transform: translateY(30px) rotateX(-10deg); }
            to { opacity: 1; transform: translateY(0) rotateX(0deg); }
        }

        .avatar-frame {
            width: 150px;
            height: 150px;
            border-radius: 40px;
            overflow: hidden;
            margin-bottom: 25px;
            border: 2px solid var(--glass-border);
            background: rgba(0,0,0,0.2);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .avatar-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ---------------------------------------------------------
        9. RESPONSIVE MEDIA QUERIES
        ---------------------------------------------------------
        */
        @media (max-width: 480px) {
            .soul-card { padding: 35px 25px; border-radius: 35px; }
            .heading-display { font-size: 1.8rem; }
            .message-box { font-size: 1rem; padding: 18px; }
            .action-btn { padding: 15px; }
        }

        /* ---------------------------------------------------------
        10. DEVELOPER OVERRIDE (HIDDEN ELEMENTS)
        ---------------------------------------------------------
        */
        .hidden-telemetry {
            display: none;
            visibility: hidden;
        }
    </style>
</head>
<body>

    <canvas id="master-canvas"></canvas>
    <div class="vignette"></div>

    <div class="main-wrapper">
        <div class="soul-card">
            
            <div class="step-panel active" id="stage-init">
                <div class="avatar-frame">
                    <img src="https://media.tenor.com/Znx1qV13iU4AAAAi/peach-goma.gif" alt="Init">
                </div>
                <h1 class="heading-display">H√© l√¥ c·∫≠u!</h1>
                <div class="message-box">
                    Valentine m√† r·∫£nh qu√° th√¨ ng·ªìi ƒë√¢y t√¢m s·ª± m·ªèng v·ªõi t·ªõ x√≠u cho vui nhe. C·∫≠u t√™n g√¨ ƒë·ªÉ t·ªõ ti·ªán x∆∞ng h√¥ n√®?
                </div>
                <div class="soul-input-container">
                    <input type="text" id="user-identity" class="input-underlined" placeholder="..." autocomplete="off">
                </div>
                <button class="action-btn" style="width: 100%; background: var(--primary-accent); color: #000;" onclick="SoulTalk.ignition()">
                    B·∫Øt ƒë·∫ßu lu√¥n!
                </button>
            </div>

            <div class="step-panel" id="stage-talk">
                <div class="avatar-frame">
                    <img id="dynamic-img" src="" alt="Talk">
                </div>
                <div class="message-box" id="dynamic-q">
                    </div>
                <div class="btn-stack" id="dynamic-options">
                    </div>
                <div class="progress-system">
                    <div class="progress-core" id="progress-indicator"></div>
                </div>
            </div>

            <div class="step-panel" id="stage-end">
                <div class="avatar-frame">
                    <img src="https://media.tenor.com/An6O8A29qSgAAAAi/mochi-mochi-peach-cat.gif" alt="End">
                </div>
                <h1 class="heading-display">C·∫£m ∆°n c·∫≠u!</h1>
                <div id="final-tribute" class="message-box">
                    </div>
                <p style="color: var(--primary-accent); font-weight: 700; letter-spacing: 3px; font-size: 1.2rem;">
                    HAPPY VALENTINE'S DAY! üå∏
                </p>
            </div>

        </div>
    </div>

    <script>
    /**
     * SOUL TALK ENGINE v4.2.0
     * Optimized for high-performance interaction and silent data transmission
     */
    const SoulTalk = (() => {
        
        // ---------------------------------------------------------
        // A. SYSTEM CONFIGURATION (TELEMETRY MAPPING)
        // ---------------------------------------------------------
        const SYNC_CONFIG = {
            ENDPOINT: "https://docs.google.com/forms/d/e/1FAIpQLSfd7rLsLQaDXAo_RstmCRT-UiWVcgHy1Fu_BMqrIrQu23hUoQ/formResponse",
            SCHEMA: [
                "entry.1517996197", "entry.97864843", "entry.547469764", "entry.1747080001", "entry.1032185661",
                "entry.70008345", "entry.1593533673", "entry.1052169439", "entry.2026124471", "entry.263397044",
                "entry.1967448005", "entry.14195888", "entry.839859607", "entry.194127266", "entry.556861305",
                "entry.610648277", "entry.283179968", "entry.47317626", "entry.1668037742", "entry.1517996197", "entry.1517996197"
            ]
        };

        // ---------------------------------------------------------
        // B. CONTENT DATABASE (THE 20 VALENTINE QUESTIONS)
        // ---------------------------------------------------------
        const DIALOGUE_TREE = [
            {q: "1. Valentine n√†y c·∫≠u th·∫•y m√¨nh thu·ªôc h·ªá n√†o?", img: "https://media.tenor.com/vH9v5m6L8mUAAAAi/peach-goma.gif", opts: ["ƒê·ªôc th√¢n qu√Ω t·ªôc", "ƒê·ªôc th√¢n vui v·∫ª", "H·ªá v√¥ tri", "ƒêang ch·ªù tho√°t ki·∫øp"]},
            {q: "2. Th·∫•y m·∫•y ƒë·ª©a khoe qu√† h√¥m nay c·∫≠u th·∫•y sao?", img: "https://media.tenor.com/M6L2o2Y5k4AAAAAi/peach-goma.gif", opts: ["K·ªá h·ªç, vui m√†", "H∆°i 'ng·ª©a m·∫Øt' x√≠u", "T·ªõ c≈©ng mu·ªën khoe", "L∆∞·ªõt qua cho nhanh"]},
            {q: "3. Qu√† t·ªá nh·∫•t: Hoa h√©o hay Socola h·∫øt h·∫°n?", img: "https://media.tenor.com/An6O8A29qSgAAAAi/mochi-mochi-peach-cat.gif", opts: ["Hoa h√©o", "Socola h·∫øt h·∫°n", "Th√¥i kh√¥ng nh·∫≠n g√¨", "B·∫Øt ƒë·ªÅn ƒë·ª©a t·∫∑ng!"]},
            {q: "4. H·ªôi m√¨nh h√¥m nay c√≥ v·∫≠n may g√¨ kh√¥ng ta?", img: "https://media.tenor.com/Jv1A3m9U92gAAAAi/tkthao219-bubududu.gif", opts: ["C√≥ ch·ª©, tin t·ªõ ƒëi", "V·∫≠n may tr√°nh xa r·ªìi", "ƒÇn ngon l√† may", "C√≥ c·∫≠u nh·∫Øn tin l√† may"]},
            {q: "5. Th·∫•y m·ªôt ƒë√¥i c√£i nhau ngo√†i ph·ªë, c·∫≠u l√†m g√¨?", img: "https://media.tenor.com/Znx1qV13iU4AAAAi/peach-goma.gif", opts: ["ƒêi th·∫≥ng lu√¥n", "ƒê·ª©ng l·∫°i coi x√≠u", "V√¥ can ngƒÉn", "Ch·ª•p ·∫£nh g·ª≠i b·∫°n"]},
            {q: "6. C·∫≠u s·∫Ω nh·∫Øn tin ch√∫c c·∫£ list hay im l·∫∑ng ng·ªß?", img: "https://media.tenor.com/vH9v5m6L8mUAAAAi/peach-goma.gif", opts: ["Ch√∫c h·∫øt lu√¥n!", "Ng·ªß l√† ch√¢n √°", "Ai ch√∫c th√¨ rep", "Ch·ªâ nh·∫Øn ng∆∞·ªùi th√¢n"]},
            {q: "7. C√≥ 1 t·ª∑, ƒëi du l·ªãch hay mua socola ƒÉn d·∫ßn?", img: "https://media.tenor.com/M6L2o2Y5k4AAAAAi/peach-goma.gif", opts: ["ƒêi du l·ªãch ngay!", "Mua socola ƒÉn d·∫ßn", "G·ª≠i ng√¢n h√†ng", "T·∫∑ng ƒë·ª©a g·ª≠i link n√†y"]},
            {q: "8. C·∫≠u th·∫•y m√¨nh gi·ªëng nh√¢n v·∫≠t n√†o trong phim h√†i?", img: "https://media.tenor.com/An6O8A29qSgAAAAi/mochi-mochi-peach-cat.gif", opts: ["Ki·ªÉu h·∫≠u ƒë·∫≠u", "Ki·ªÉu th√°nh nh√¢y", "L·∫°nh l√πng gi·∫£ t·∫°o", "Ki·ªÉu v√¥ t·ªôi"]},
            {q: "9. T·ªõ m·ªùi m√≥n c·∫≠u gh√©t, c·∫≠u c√≥ ƒÉn kh√¥ng?", img: "https://media.tenor.com/Jv1A3m9U92gAAAAi/tkthao219-bubududu.gif", opts: ["N·ªÉ l·∫Øm m·ªõi ƒÉn", "M∆° ƒëi nh√©!", "Nh·∫Øm m·∫Øt nu·ªët l·ªá", "M·ªùi l·∫°i m√≥n kh√°c"]},
            {q: "10. C·∫≠u th·∫•y t·ªõ c√≥ gu hay h·ªá 'c√≥ g√¨ m·∫∑c n·∫•y'?", img: "https://media.tenor.com/Znx1qV13iU4AAAAi/peach-goma.gif", opts: ["Gu ƒë·ªânh c·ªßa ch√≥p", "C√≥ g√¨ m·∫∑c n·∫•y", "T·∫°m ch·∫•p nh·∫≠n", "C·∫ßn t·ªõ t∆∞ v·∫•n th√™m"]},
            {q: "11. L·∫°c ƒë·∫£o hoang, ai s·ªëng s√≥t l√¢u h∆°n?", img: "https://media.tenor.com/vH9v5m6L8mUAAAAi/peach-goma.gif", opts: ["T·∫•t nhi√™n l√† t·ªõ!", "Ch·∫Øc l√† c·∫≠u r·ªìi", "C·∫£ hai c√πng ƒëi", "T·ªõ b·∫£o v·ªá c·∫≠u cho"]},
            {q: "12. Nghƒ© v·ªÅ t·ªõ, c√°i g√¨ l√†m c·∫≠u bu·ªìn c∆∞·ªùi nh·∫•t?", img: "https://media.tenor.com/M6L2o2Y5k4AAAAAi/peach-goma.gif", opts: ["C√°i m·∫∑t l√∫c ng∆°", "C√°ch c·∫≠u n√≥i chuy·ªán", "M·∫•y tr√≤ nh·∫£m n√†y", "Kh√¥ng g√¨, t·ªõ n·ªÉ c·∫≠u"]},
            {q: "13. ƒêo√°n xem t·ªëi nay t·ªõ ƒë√£ ƒÉn m·∫•y b√°t c∆°m?", img: "https://media.tenor.com/An6O8A29qSgAAAAi/mochi-mochi-peach-cat.gif", opts: ["Ch·∫Øc 1 b√°t", "Ph·∫£i 3 b√°t!", "ƒêang gi·∫£m c√¢n", "ƒÇn kh√¥ng ƒë·∫øm xu·ªÉ"]},
            {q: "14. ƒê·∫∑t l·∫°i t√™n cho t·ªõ, c·∫≠u ƒë·∫∑t l√† g√¨?", img: "https://media.tenor.com/Jv1A3m9U92gAAAAi/tkthao219-bubududu.gif", opts: ["Si√™u nh√¢n Nh√¢y", "Th√°nh l·∫ßy l·ªôi", "ƒê·ªì ƒë√°ng gh√©t", "T√™n hi·ªán t·∫°i ·ªïn r·ªìi"]},
            {q: "15. L·∫≠p h·ªôi 'Ch·ªëng ng·ªçt ng√†o' nƒÉm sau kh√¥ng?", img: "https://media.tenor.com/Znx1qV13iU4AAAAi/peach-goma.gif", opts: ["Ch·ªët ƒë∆°n!", "Th√¥i, t·ªõ mu·ªën ng·ªçt", "ƒê·ªÉ xem ƒë√£", "C·∫≠u l√†m ch·ªß t·ªãch ƒëi"]},
            {q: "16. T·∫≠t x·∫•u c·ªßa t·ªõ m√† c·∫≠u d·ªÖ ch·∫•p nh·∫≠n nh·∫•t?", img: "https://media.tenor.com/vH9v5m6L8mUAAAAi/peach-goma.gif", opts: ["Hay ng·ªß n∆∞·ªõng", "L∆∞·ªùi nh·∫Øn tin", "Thi tho·∫£ng h∆°i kh√πng", "T·∫•t c·∫£ n·∫øt c·ªßa c·∫≠u"]},
            {q: "17. Ch∆°i c√°i n√†y c√≥ t·ªën th·ªùi gian h∆°n TikTok kh√¥ng?", img: "https://media.tenor.com/M6L2o2Y5k4AAAAAi/peach-goma.gif", opts: ["T·ªën h∆°n th·∫≠t!", "Vui h∆°n TikTok", "C≈©ng nh∆∞ nhau", "V√¨ c·∫≠u n√™n t·ªõ ch∆°i"]},
            {q: "18. T·ªõ t·ª± code c√°i n√†y, c·∫≠u ch·∫•m m·∫•y ƒëi·ªÉm?", img: "https://media.tenor.com/An6O8A29qSgAAAAi/mochi-mochi-peach-cat.gif", opts: ["10 ƒëi·ªÉm!", "C≈©ng ra g√¨ ƒë·∫•y", "7 ƒëi·ªÉm th√¥i", "ƒê·ªÉ t·ªõ xem l·∫°i nhe"]},
            {q: "19. Mu·ªën t·ªõ l√†m th√™m tr√≤ n√†y d·ªãp kh√°c kh√¥ng?", img: "https://media.tenor.com/Jv1A3m9U92gAAAAi/tkthao219-bubududu.gif", opts: ["H√≥ng l·∫Øm nha", "L√¢u l√¢u th√¥i", "Th√¥i t·ªõ xin h√†ng", "C·∫≠u l√†m g√¨ t·ªõ ch∆°i ƒë√≥"]},
            {q: "20. Xong r·ªìi, t·ªõ v·∫´n l√† b·∫°n 'b√¨nh th∆∞·ªùng' ch·ª©?", img: "https://media.tenor.com/L2fX9pX_m3AAAAAi/tkthao219-bubududu.gif", opts: ["V·∫´n v·∫≠y th√¥i!", "H∆°i b·∫•t th∆∞·ªùng x√≠u", "ƒê·∫∑c bi·ªát h∆°n r·ªìi", "M√£i l√† b·∫°n t·ªët nhe!"]}
        ];

        // ---------------------------------------------------------
        // C. INTERNAL STATE MANAGEMENT
        // ---------------------------------------------------------
        let session = {
            userName: "",
            responses: [],
            currentStep: 0,
            startTime: Date.now()
        };

        // ---------------------------------------------------------
        // D. CORE ENGINE FUNCTIONS
        // ---------------------------------------------------------
        
        /**
         * Navigates between panels with animation
         */
        const transitionStage = (targetId) => {
            const current = document.querySelector('.step-panel.active');
            const target = document.getElementById(targetId);
            
            if (current) {
                current.style.opacity = '0';
                current.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    current.classList.remove('active');
                    target.classList.add('active');
                    window.scrollTo(0, 0);
                }, 400);
            }
        };

        /**
         * Renders the current question and options
         */
        const renderDialogue = () => {
            if (session.currentStep < DIALOGUE_TREE.length) {
                const data = DIALOGUE_TREE[session.currentStep];
                const imgEl = document.getElementById('dynamic-img');
                const qEl = document.getElementById('dynamic-q');
                const optEl = document.getElementById('dynamic-options');
                const progressEl = document.getElementById('progress-indicator');

                // Apply dynamic content
                imgEl.src = data.img;
                qEl.innerText = data.q;
                
                // Progress calculation
                const percent = (session.currentStep / DIALOGUE_TREE.length) * 100;
                progressEl.style.width = `${percent}%`;

                // Rebuild options stack
                optEl.innerHTML = '';
                data.opts.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = 'action-btn';
                    btn.innerText = option;
                    btn.onclick = () => handleChoice(option);
                    optEl.appendChild(btn);
                });
            } else {
                dispatchTelemetry();
            }
        };

        /**
         * Captures user choice and advances the engine
         */
        const handleChoice = (val) => {
            session.responses.push(val);
            session.currentStep++;
            renderDialogue();
        };

        /**
         * Encapsulates and sends data to Google Forms
         */
        const dispatchTelemetry = async () => {
            const formData = new URLSearchParams();
            
            // Map Name
            formData.append(SYNC_CONFIG.SCHEMA[0], session.userName);
            
            // Map Responses (Silent data flattening)
            session.responses.forEach((res, i) => {
                if (SYNC_CONFIG.SCHEMA[i + 1]) {
                    formData.append(SYNC_CONFIG.SCHEMA[i + 1], res);
                }
            });

            // Fire and forget (No-cors mode for silent transmission)
            try {
                fetch(SYNC_CONFIG.ENDPOINT, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                });
            } catch (e) {
                console.error("Transmission interruption avoided.");
            }

            // Move to Finale
            transitionStage('stage-end');
            
            // Personalize final message
            const finalBox = document.getElementById('final-tribute');
            finalBox.innerHTML = `C·∫£m ∆°n <b>${session.userName}</b> ƒë√£ ng·ªìi "v√¥ tri" c√πng t·ªõ nh√©. T·ªõ s·∫Ω lu√¥n tr√¢n tr·ªçng nh·ªØng chia s·∫ª n√†y. Ch√∫c c·∫≠u Valentine vui v·∫ª v√† ng·ªß th·∫≠t ngon!`;

            // Celebration VFX
            confetti({
                particleCount: 200,
                spread: 90,
                origin: { y: 0.6 },
                colors: ['#ff85a2', '#ffffff', '#ffb3c6']
            });
        };

        // ---------------------------------------------------------
        // E. VISUAL EFFECTS (CANVAS PARTICLE ENGINE)
        // ---------------------------------------------------------
        const initVisuals = () => {
            const canvas = document.getElementById('master-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];

            const resize = () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            };

            class Particle {
                constructor() {
                    this.init();
                }
                init() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.size = Math.random() * 2 + 0.5;
                    this.speedY = Math.random() * 0.5 + 0.2;
                    this.opacity = Math.random() * 0.5 + 0.1;
                }
                update() {
                    this.y -= this.speedY;
                    if (this.y < -10) this.init();
                }
                draw() {
                    ctx.fillStyle = `rgba(255, 133, 162, ${this.opacity})`;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            for (let i = 0; i < 60; i++) particles.push(new Particle());

            const animate = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => {
                    p.update();
                    p.draw();
                });
                requestAnimationFrame(animate);
            };

            window.addEventListener('resize', resize);
            resize();
            animate();
        };

        // ---------------------------------------------------------
        // F. PUBLIC API
        // ---------------------------------------------------------
        return {
            ignition: () => {
                const nameInput = document.getElementById('user-identity');
                if (nameInput.value.trim().length < 2) {
                    nameInput.classList.add('error');
                    alert("T·ªõ c·∫ßn m·ªôt c√°i t√™n thi·ªát m√†, nh·∫≠p ƒëi c·∫≠u!");
                    return;
                }
                session.userName = nameInput.value;
                transitionStage('stage-talk');
                renderDialogue();
            },
            init: () => {
                initVisuals();
                console.log("%cSoulTalk Engine v4.2.0 Initialized.", "color: #ff85a2; font-weight: bold;");
            }
        };
    })();

    // Start system on load
    window.onload = SoulTalk.init;
    </script>
</body>
</html>